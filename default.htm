<!DOCTYPE html>
<html lang="de" data-ng-app="tn" data-ng-controller="MainController as main">
<!--
    Copyright (C) 2015, Manuel Meitinger

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 -->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trainee</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/uikit.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/components/tooltip.min.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/uikit.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/components/tooltip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-i18n/1.4.7/angular-locale_de.js"></script>
    <script type="text/javascript" src="tn.js"></script>
</head>
<body>
    <nav class="uk-navbar uk-navbar-attached">
    </nav>
    <button class="uk-button" data-ng-click="main.exec()">Abfrage</button>
    <div class="uk-panel uk-panel-box uk-overflow-container" data-ng-controller="LogController as log">
    	<div data-ng-if="!log.notify.getLastSyncTime() && !log.notify.getError()" class="uk-panel-badge uk-badge">Initialisierung</div>
        <div data-ng-if="!log.notify.getLastSyncTime() && log.notify.getError()" class="uk-panel-badge uk-badge uk-badge-warning" data-uk-tooltip="data-uk-tooltip" title="Fehler: {{log.notify.getError()}}">Initialisierung (Fehler)</div>
        <div data-ng-if="log.notify.getLastSyncTime() && !log.notify.getError()" class="uk-panel-badge uk-badge uk-badge-success" data-uk-tooltip="data-uk-tooltip" title="Letzte Synchronisierung: {{(log.notify.getLastSyncTime() | date: 'medium') || 'nie'}}&#x000a;Letzte Änderung: {{(log.notify.getLastEvent() | date: 'medium') || 'noch keine'}}">Synchronisiert</div>
        <div data-ng-if="log.notify.getLastSyncTime() && log.notify.getError()" class="uk-panel-badge uk-badge uk-badge-danger" title="Fehler: {{log.notify.getError()}}&#x000a;Letzte Synchronisierung: {{(log.notify.getLastSyncTime() | date: 'medium') || 'nie'}}">Synchronisierungsfehler</div>
        <h3 class="uk-panel-title">Datenbanklog</h3>
        <table class="uk-table uk-table-hover uk-table-condensed">
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Beschreibung</th>
                    <th>Letzte Ausführung</th>
                    <th>Fehler</th>
                    <th>Aktion</th>
                </tr>
            </thead>
            <tbody>
                <tr data-ng-repeat="command in log.sql.commands | orderBy: '$index':true | limitTo: log.limit : log.offset" data-uk-tooltip="data-uk-tooltip" title="{{command.sql}}">
                    <td data-ng-switch="command.getState()">
                        <div class="uk-badge" data-ng-switch-when="0">Warten auf Genehmigung</div>
                        <div class="uk-badge" data-ng-switch-when="1">Wird ausgeführt</div>
                        <div class="uk-badge uk-badge-warning" data-ng-switch-when="2">Fehler</div>
                        <div class="uk-badge uk-badge-success" data-ng-switch-when="3">Abgeschlossen</div>
                        <div class="uk-badge uk-badge-danger" data-ng-switch-when="4">Abgebrochen</div>
                        <div class="uk-badge uk-badge-danger" data-ng-switch-when="5">Fehlgeschlagen</div>
                    </td>
                    <td><span>{{command.description}}</span></td>
                    <td><span>{{command.getLastExecuteTime() | date: 'medium'}}</span></td>
                    <td><span>{{command.getError()}}</span></td>
                    <td>
                        <button class="uk-button uk-button-mini uk-button-success" data-ng-disabled="command.getState() != 0" data-ng-click="command.approve()">Genehmigen</button>
                        <button class="uk-button uk-button-mini uk-button-primary" data-ng-disabled="command.getState() != 2" data-ng-click="command.retry()">Wiederholen</button>
                        <button class="uk-button uk-button-mini uk-button-danger" data-ng-disabled="command.getState() != 2 || !command.abortable" data-ng-click="command.abort()">Abbrechen</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <form class="uk-form">
        	<button class="uk-button" data-ng-class="log.sql.reviewCommands ? 'uk-active' : ''" data-ng-click="log.sql.reviewCommands = !log.sql.reviewCommands">Abfragen genehmigen <span data-ng-class="log.sql.reviewCommands ? 'uk-text-success' : 'uk-text-danger'">{{log.sql.reviewCommands ? 'AN' : 'AUS'}}</span></button>
        	<div class="uk-button-group">
        	    <button class="uk-button" data-ng-disabled="log.offset == 0" data-ng-click="log.offset = Math.max(0, Math.floor(log.offset/log.limit)-1) * log.limit"><i class="uk-icon-angle-double-left"></i>Neuere</button>
        	    <button class="uk-button" data-ng-disabled="log.offset + log.limit &gt;= log.sql.commands.length" data-ng-click="log.offset = log.offset + log.limit">Ältere <i class="uk-icon-angle-double-right"></i></button>
       		</div>
        	<select data-ng-model="log.limit" data-ng-options="limit as limit for limit in log.limitOptions"></select>
        </form>
    </div>
</body>
</html>
