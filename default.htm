<!DOCTYPE html>
<html lang="de" data-ng-app="tn" data-ng-controller="MainController as main">
<!--
    Copyright (C) 2015, Manuel Meitinger

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 -->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trainee</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/uikit.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/components/tooltip.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/handsontable/0.20.2/handsontable.full.min.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/uikit.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/components/tooltip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.8/angular.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-i18n/1.4.8/angular-locale_de.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handsontable/0.20.2/handsontable.full.js"></script>
    <script type="text/javascript" src="ngHandsontable.js"></script>
    <script type="text/javascript" src="tn.js"></script>
</head>
<body>
    <nav class="uk-navbar uk-navbar-attached">
        <ul class="uk-navbar-nav">
            <li class="uk-hidden-small" data-ng-class="main.currentNav == $index ? 'uk-active' : ''" data-ng-repeat="nav in main.navs"><a data-ng-click="main.gotoNav($index)">{{nav}}</a></li>
        </ul>
    </nav>
    <div data-ng-repeat="tab in main.tabs" data-ng-show="main.currentTab == $index" data-ng-switch="tab.type">
        <form class="uk-form" data-ng-switch-when="attendance" data-ng-controller="AttendanceController as atn">
            <select data-ng-model="atn.year" data-ng-change="atn.update()" data-ng-options="year as year for year in [2015]"></select> 
            <select data-ng-model="atn.month" data-ng-change="atn.update()" data-ng-options="month as month for month in [1,2,3,4,5,6,7,8,9,10,11,12]"></select> 
            <table class="uk-table uk-table-hover uk-table-condensed">
                <thead>
                    <tr>
                        <th>Standort</th>
                        <th>Teilnehmer</th>
                        <th data-ng-repeat="tag in atn.tage">{{(Date(atn.year, atn.month-1, $index+1)) | date: 'short'}}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ng-repeat="zeitspanne in atn.zeitspannen.rows">
                        <td>{{zeitspanne.Einrichtung}}</td>
                        <td>{{zeitspanne.Teilnehmer}}</td>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>
    <ul class="uk-tab uk-tab-bottom" data-uk-tab="" data-ng-if="main.currentNav &gt; -1">
        <li data-ng-class="main.currentTab == $index ? 'uk-active' : ''" data-ng-repeat="tab in main.tabs"><a data-ng-click="main.gotoTab($index)">{{tab.name}}</a></li>
    </ul>
    <div class="uk-panel uk-panel-box" data-ng-controller="LogController as log">
    	<div data-ng-if="!log.notification.lastSyncTime &amp;&amp; !log.notification.error" class="uk-panel-badge uk-badge">Initialisierung</div>
        <div data-ng-if="!log.notification.lastSyncTime &amp;&amp; log.notification.error" class="uk-panel-badge uk-badge uk-badge-warning" data-uk-tooltip="data-uk-tooltip" title="Fehler: {{log.notification.error}}">Initialisierung (Fehler)</div>
        <div data-ng-if="log.notification.lastSyncTime &amp;&amp; !log.notification.error" class="uk-panel-badge uk-badge uk-badge-success" data-uk-tooltip="data-uk-tooltip" title="Letzte Synchronisierung: {{(log.notification.lastSyncTime | date: 'medium') || 'nie'}}&#x000a;Letzte Änderung: {{(log.notification.lastEventTime | date: 'medium') || 'noch keine'}}">Synchronisiert</div>
        <div data-ng-if="log.notification.lastSyncTime &amp;&amp; log.notification.error" class="uk-panel-badge uk-badge uk-badge-danger" data-uk-tooltip="data-uk-tooltip" title="Fehler: {{log.notification.error}}&#x000a;Letzte Synchronisierung: {{(log.notification.lastSyncTime | date: 'medium') || 'nie'}}">Synchronisierungsfehler</div>
        <h3 class="uk-panel-title">Datenbanklog</h3>
        <div class="uk-overflow-container" style="max-height:300px;">
            <table class="uk-table uk-table-hover uk-table-condensed">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Beschreibung</th>
                        <th>Letzte Ausführung</th>
                        <th>Fehler</th>
                        <th>Aktion</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ng-repeat="command in log.sql.commands | filter:log.filter | orderBy:'lastExecuteTime':true" data-uk-tooltip="data-uk-tooltip" title="{{command.sql}}">
                        <td data-ng-switch="command.state">
                            <div class="uk-badge" data-ng-switch-when="0">Warten auf Genehmigung</div>
                            <div class="uk-badge" data-ng-switch-when="1">Wird ausgeführt</div>
                            <div class="uk-badge uk-badge-warning" data-ng-switch-when="2">Fehler</div>
                            <div class="uk-badge uk-badge-success" data-ng-switch-when="3">Abgeschlossen</div>
                            <div class="uk-badge uk-badge-danger" data-ng-switch-when="4">Abgebrochen</div>
                            <div class="uk-badge uk-badge-danger" data-ng-switch-when="5">Fehlgeschlagen</div>
                        </td>
                        <td><span>{{command.description}}</span></td>
                        <td><span>{{(command.lastExecuteTime | date: 'medium') || '(noch nie)'}}</span></td>
                        <td><span>{{command.error}}</span></td>
                        <td>
                            <button class="uk-button uk-button-mini uk-button-success" data-ng-disabled="command.state != 0" data-ng-click="command.approve()">Genehmigen</button>
                            <button class="uk-button uk-button-mini uk-button-primary" data-ng-disabled="command.state != 2" data-ng-click="command.retry()">Wiederholen</button>
                            <button class="uk-button uk-button-mini uk-button-danger" data-ng-disabled="command.state != 2 || !command.abortable" data-ng-click="command.abort()">Abbrechen</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button class="uk-button" data-ng-class="log.sql.reviewCommands ? 'uk-active' : ''" data-ng-click="log.sql.reviewCommands = !log.sql.reviewCommands">Abfragen genehmigen <span data-ng-class="log.sql.reviewCommands ? 'uk-text-success' : 'uk-text-danger'">{{log.sql.reviewCommands ? 'AN' : 'AUS'}}</span></button>
    </div>
</body>
</html>
